# Известные проблемы aigrep v2.1.3

Документ содержит известные дефекты и ограничения aigrep, выявленные при аудите качества.

**Дата последнего обновления:** 22.01.2026
**Текущая версия aigrep:** 2.1.3
**Vault для тестирования:** Naumen_CTO

---

## Исправленные проблемы

### 1. ✅ test_retrieval падает с AttributeError — ИСПРАВЛЕНО в v2.1.2

**Описание:**
Функция `test_retrieval` падала с ошибкой `'DocumentSearchResult' object has no attribute 'title'`.

**Исправление:**
Изменён доступ к атрибутам: `result.title` → `result.document.title`, `result.file_path` → `result.document.file_path`.

---

### 2. ✅ Фильтр `links:` не разрешает короткие ID — ИСПРАВЛЕНО в v2.1.2

**Описание:**
Фильтр `links:` требовал указания полного пути к документу.

**Исправление:**
Fuzzy matching теперь включается автоматически. `links:vshadrin` разрешается в полные пути через substring matching.

---

### 3. ✅ 80% чанков слишком маленькие (<100 токенов) — ИСПРАВЛЕНО в v2.1.2

**Описание:**
Chunker разбивал документы слишком мелко. Параметр `min_chunk_size` не использовался.

**Исправление:**
Добавлен алгоритм chunk merging (`_merge_small_chunks()`). Чанки меньше `min_chunk_size` (100 токенов) объединяются с соседними.

---

### 4. ⚠️ Enrichment по умолчанию отключен — ЭТО ФИЧА, НЕ ДЕФЕКТ

**Описание:**
При индексации без явного указания `enrichment` все чанки получают пустой `context_prefix`.

**Решение:**
Это осознанное решение в v2.1.1 для ускорения индексации у пользователей без LLM.

Для включения enrichment используйте:
```python
reindex_vault("Naumen_CTO", confirm=True, enrichment="contextual")
```

Или флаг CLI: `--enable-enrichment`

---

## Ограничения (не дефекты)

### Комбинация фильтров `type:X links:Y`

**Статус:** ✅ Работает корректно

Тесты показывают, что `type:1-1 links:ivanov` находит документы правильно. Рекомендация ниже — для сложных случаев с множественными OR.

**Workaround для сложных случаев:**
```python
# Если нужно OR между разными типами фильтров:
result1 = search_vault("vault", "type:1-1")
result2 = get_backlinks("vault", "person_path.md")
# Пересечь результаты вручную
```

### OR синтаксис фильтров

**Семантика:** `tags:python OR tags:javascript`
- `tags = ['python']` — обязательный тег (AND с остальными фильтрами)
- `tags_or = ['javascript']` — дополнительный тег (AND с остальными, OR внутри группы)

Это означает: "документы с тегом python И хотя бы одним из tags_or".

### Даты

Фильтр `created:>YYYY-MM-DD` работает корректно. Альтернатива:
```python
timeline("vault", after="2024-01-01")
```

### Русские имена

Поиск по русским именам может быть ненадёжен. Рекомендуется использовать ID из frontmatter.

---

## История изменений

| Дата | Версия | Изменения |
|------|--------|-----------|
| 22.01.2026 | 2.1.3 | Актуализация документа, отметка исправленных проблем |
| 22.01.2026 | 2.1.2 | Исправлены #1, #2, #3 |
| 22.01.2026 | 2.0.9 | Документ создан после аудита Naumen_CTO |
