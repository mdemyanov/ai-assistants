# Субагенты (Subagents)

Субагенты — специализированные агенты, которые Claude Code может запускать через Task tool для автономного выполнения сложных задач.

## Когда создавать субагент

| Сценарий | Субагент нужен? |
|----------|-----------------|
| Задача требует многошаговой автономной работы | Да |
| Нужна специализация (explore, plan, build) | Да |
| Простая однократная операция | Нет, достаточно skill |
| Задача выполняется в контексте разговора | Нет |

## Встроенные субагенты Claude Code

| Тип | Назначение | Инструменты |
|-----|-----------|-------------|
| `Explore` | Исследование codebase | Glob, Grep, Read, WebFetch, WebSearch |
| `Plan` | Проектирование реализации | Все кроме Task, Edit, Write |
| `Bash` | Выполнение команд | Bash |
| `general-purpose` | Универсальные задачи | Все инструменты |

## Создание кастомного субагента

### Структура

```
templates/subagent-template/
├── SUBAGENT.md          # Инструкции для субагента
└── config.json          # Конфигурация (опционально)
```

### SUBAGENT.md

```markdown
---
name: my-subagent
description: Краткое описание что делает субагент
tools: [Glob, Grep, Read, Bash]  # Доступные инструменты
---

# My Subagent

[Инструкции для субагента — что он должен делать]

## Workflow

1. [Первый шаг]
2. [Второй шаг]
3. [Завершение и возврат результата]

## Формат результата

[Как субагент должен форматировать ответ]
```

### Интеграция с SKILL.md

В SKILL.md укажи когда делегировать к субагенту:

```markdown
## Делегирование

При получении запроса на [тип задачи]:

1. Запусти субагент через Task tool:
   - `subagent_type: "my-subagent"`
   - `prompt: "[детали задачи]"`

2. Дождись результата и обработай
```

## Примеры использования

### Explore субагент (встроенный)

```
Task tool:
  subagent_type: Explore
  prompt: "Найди все файлы где определены API endpoints"
  description: "Find API endpoints"
```

### Plan субагент (встроенный)

```
Task tool:
  subagent_type: Plan
  prompt: "Спроектируй реализацию системы авторизации"
  description: "Design auth system"
```

### Кастомный субагент

```
Task tool:
  subagent_type: code-reviewer
  prompt: "Проверь PR #123 на соответствие code style"
  description: "Review PR code style"
```

## Лучшие практики

1. **Специализация** — каждый субагент решает узкую задачу
2. **Минимум инструментов** — ограничивай `tools` только необходимыми
3. **Чёткий результат** — опиши формат возвращаемого результата
4. **Автономность** — субагент должен работать без уточняющих вопросов
5. **Идемпотентность** — повторный запуск даёт тот же результат

## Ограничения

- Субагент не видит историю разговора (кроме `general-purpose`)
- Субагент не может запускать другие субагенты (нет Task tool)
- Результат возвращается как текст, не как structured data

## Связь со Skills

| Концепт | Назначение |
|---------|-----------|
| Skill | Инструкции для Claude в контексте разговора |
| Субагент | Автономное выполнение задачи в отдельном процессе |

Skills могут делегировать работу субагентам через Task tool, создавая двухуровневую архитектуру.
