# Фильтры tg-parser

9 типов фильтров для точной выборки сообщений. Фильтры комбинируются через AND.

## Фильтры по дате

| Опция | Описание | Пример |
|-------|----------|--------|
| `--date-from` | Начало периода (включительно) | `--date-from 2026-01-01` |
| `--date-to` | Конец периода (включительно) | `--date-to 2026-01-31` |
| `--last-days` | Последние N дней | `--last-days 7` |
| `--last-hours` | Последние N часов | `--last-hours 24` |

**MCP эквивалент:**
```
date_from: "2026-01-01"
date_to: "2026-01-31"
last_days: 7
```

## Фильтры по отправителю

| Опция | Описание | Пример |
|-------|----------|--------|
| `--senders` | Включить отправителей (через запятую) | `--senders "Иван,Мария"` |
| `--exclude-senders` | Исключить отправителей | `--exclude-senders "Bot,System"` |

**Особенности:**
- Имена чувствительны к регистру
- Можно использовать часть имени (substring match)
- Для точного совпадения используй полное имя

**MCP эквивалент:**
```
senders: ["Иван", "Мария"]
```

## Фильтры по топикам (форумы)

| Опция | Описание | Пример |
|-------|----------|--------|
| `--topics` | Включить топики | `--topics "general,bugs"` |
| `--exclude-topics` | Исключить топики | `--exclude-topics "offtopic"` |

**Особенности:**
- Работает только для supergroup с включёнными топиками
- Названия топиков определяются по `topic_created` сообщениям
- General topic (ID=1) существует всегда

**MCP эквивалент:**
```
topics: ["general", "bugs"]
```

## Фильтр по содержимому

| Опция | Описание | Пример |
|-------|----------|--------|
| `--contains` | Regex-паттерн в тексте | `--contains "решили\|договорились"` |
| `--min-length` | Минимальная длина текста | `--min-length 50` |

**Паттерны для типичных задач:**

| Задача | Regex |
|--------|-------|
| Решения | `решили\|договорились\|утвердили\|одобрено` |
| Вопросы | `\?$` |
| Ссылки | `https?://` |
| Упоминания кода | `\`\`\`\|function\|class\|def ` |
| Даты | `\d{2}\.\d{2}\.\d{4}` |

**MCP эквивалент:**
```
contains: "решили|договорились"
```

## Фильтр по упоминаниям

| Опция | Описание | Пример |
|-------|----------|--------|
| `--mentions` | Сообщения с упоминанием | `--mentions "@username"` |

**Особенности:**
- Ищет `@username` в тексте сообщения
- Можно указать несколько через запятую

## Фильтры по типу контента

| Опция | Описание |
|-------|----------|
| `--has-attachment` | Только с вложениями (фото, видео, файлы) |
| `--has-reactions` | Только с реакциями |
| `--exclude-forwards` | Исключить пересланные сообщения |
| `--include-service` | Включить сервисные сообщения |

**Сервисные сообщения:** вход/выход участников, смена названия, закреп, создание топика

## Комбинации фильтров

**Дайджест за неделю от ключевых участников:**
```bash
tg-parser parse ./export.json \
  --last-days 7 \
  --senders "Иван,Мария,Алексей" \
  --exclude-service \
  -f markdown
```

**Решения по архитектуре за месяц:**
```bash
tg-parser parse ./export.json \
  --date-from 2026-01-01 \
  --topics "architecture" \
  --contains "решили|утвердили|выбрали" \
  -f markdown
```

**Сообщения с вложениями и реакциями:**
```bash
tg-parser parse ./export.json \
  --has-attachment \
  --has-reactions \
  -f json
```

## Порядок применения

1. Дата (date_from, date_to, last_days, last_hours)
2. Отправитель (senders, exclude_senders)
3. Топик (topics, exclude_topics)
4. Содержимое (contains, min_length)
5. Упоминания (mentions)
6. Тип контента (attachment, reactions, forwards, service)

Все фильтры применяются как AND — сообщение должно удовлетворять всем условиям.
