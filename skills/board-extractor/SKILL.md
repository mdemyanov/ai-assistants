---
name: board-extractor
description: Извлечение бизнес- и dev-сущностей из досок (Miro/Figma PDF, Markdown, Confluence) и конвертация в Gramax-формат для двух каталогов требований.
---

# board-extractor

Извлечение бизнес- и dev-сущностей из досок (Miro/Figma PDF, Markdown, Confluence) и конвертация в Gramax-формат для двух каталогов требований.

## Триггеры

**Slash-команды:**
- `/extract` — извлечь сущности из файла
- `/board` — интерактивное создание сущности

**Фразы:**
- "извлеки требования из..."
- "конвертируй доску..."
- "создай стейкхолдера..."
- "создай JTBD для..."
- "создай BRQ для..."
- "создай эпик для..."

## Целевые каталоги

Сущности распределяются по двум каталогам в зависимости от типа:

| Каталог | Типы сущностей | Путь |
|---------|---------------|------|
| **business-requirements/** | Стейкхолдер, JTBD, Цель, BRQ, Процесс | `business-requirements/{тип}/{sub-домен}/` |
| **product-requirements/** | Эпик, Фича, User Story, Сущность, Бизнес-правило, Релиз | `product-requirements/{тип}/{продукт}/{sub-домен}/` |

**Термин** — отдельно в `glossary/` соответствующего каталога.

### Маршрутизация

При классификации сущности определи целевой каталог:

| Если тип... | Каталог | Путь |
|-------------|---------|------|
| Стейкхолдер | business-requirements | `stakeholders/{sub-домен}/` |
| JTBD | business-requirements | `jtbd/{sub-домен}/` |
| Цель | business-requirements | `goals/{продукт}/` |
| BRQ | business-requirements | `requirements/{sub-домен}/` |
| Процесс | business-requirements | `processes/{sub-домен}/` |
| Эпик | product-requirements | `epics/{продукт}/{sub-домен}/` |
| Фича | product-requirements | `features/{продукт}/{sub-домен}/` |
| User Story | product-requirements | `stories/{продукт}/{sub-домен}/` |
| Сущность | product-requirements | `entities/{sub-домен}/` |
| Бизнес-правило | product-requirements | `entities/{sub-домен}/` |

## Поддерживаемые сущности

### business-requirements

| Тип | Формат | Описание |
|-----|--------|----------|
| **Стейкхолдер** | Пользователь/Работа/Решение | Роли с интересами, болями, JTBD |
| **JTBD** | When-Want-So | Main Job → Sub-jobs |
| **Цель** | OKR (Описание + KR) | Бизнес-цели продуктов |
| **BRQ** | Обоснование + Критерии приёмки | Бизнес-требования с трассировкой |
| **Процесс** | SIPOC + Mermaid | Бизнес-процессы |

### product-requirements

| Тип | Формат | Описание |
|-----|--------|----------|
| **Эпик** | Scope + Фичи + Stories | Крупные инициативы |
| **Фича** | Описание + Stories | Поставляемые возможности |
| **User Story** | Как-Хочу-Чтобы | Требования к реализации |
| **Сущность** | Атрибуты + связи | DDD-сущности |
| **Бизнес-правило** | Условие → Действие | Правила валидации |

### Общее

| Тип | Формат | Описание |
|-----|--------|----------|
| **Термин** | Определение | Глоссарий |

## Workflow

```
┌─────────────┐    ┌──────────────────┐    ┌─────────┐    ┌────────┐
│  Источник   │───▶│   Извлечение     │───▶│ Ревью   │───▶│ Gramax │
│ PDF/MD/Wiki │    │ + Классификация  │    │ (LLM)   │    │ файлы  │
└─────────────┘    └──────────────────┘    └─────────┘    └────────┘
```

### Шаг 1: Определение источника

1. Проверь тип файла:
   - `.pdf` → используй pdfplumber для извлечения текста
   - `.md` → читай напрямую
   - `.html` → конвертируй через markdownify

2. Определи контекст:
   - Путь к файлу
   - Целевой каталог (business-requirements или product-requirements)
   - Sub-домен (если известен)

### Шаг 2: Извлечение сущностей

1. **Для PDF из Miro/Figma:**
   - Ищи паттерны User Story: "Как [роль]", "Когда [контекст]", "Я как [роль]"
   - Учитывай разрывы слов (Miro добавляет пробелы внутри слов)
   - Группируй по стикерам/блокам

2. **Для Markdown:**
   - Ищи заголовки и структуру
   - Извлекай списки и таблицы

3. **Классифицируй каждую сущность:**
   - Определи тип и целевой каталог (см. Маршрутизация)
   - Определи атрибуты по матрице свойств каталога

### Шаг 3: Ревью с пользователем

1. Покажи извлечённые сущности в таблице
2. Предложи классификацию и целевой каталог
3. Запроси подтверждение через `AskUserQuestion`:
   - Тип сущности верный?
   - Каталог и путь корректны?
   - Атрибуты корректны?
   - Нужно объединить/разбить?

### Шаг 4: Генерация Gramax-файлов

1. Используй шаблоны из `templates/`
2. Создай файлы с правильными properties по матрице каталога
3. Сохрани в целевую директорию

## Фреймворк стейкхолдера

При создании стейкхолдера заполняй три блока:

```
ПОЛЬЗОВАТЕЛЬ
├── Интересы: что важно для роли
├── Боли/проблемы: с чем сталкивается
└── Выгоды: что хочет получить

РАБОТА
├── Роль: что делает и за что отвечает
└── JTBD: список работ для этой роли

РЕШЕНИЕ
├── Где можно помочь: точки автоматизации
├── Что можно не делать: исключения
└── Что получит пользователь: ценность
```

## Иерархия JTBD

```
Main Job (высокоуровневая работа)
├── Sub-job 1 (шаг или аспект)
├── Sub-job 2
└── Sub-job 3
    └── User Stories (реализации)
```

**Формат JTBD:**
```
When [situation/context],
I want to [motivation/action],
so I can [expected outcome].
```

**Типы работ:**
- **Functional** — выполнить задачу
- **Emotional** — почувствовать что-то
- **Social** — как меня воспринимают

## BRQ (формат)

Бизнес-требование содержит обязательные секции:
- **Описание** — что должна делать система
- **Бизнес-обоснование** — Проблема + Ожидаемый эффект
- **Критерии приёмки** — нумерованный список
- **Трассировка** — таблица связей (Цель, JTBD, Процесс, Эпик)

Опциональные секции: Зависимости, Ограничения.

## Процесс (SIPOC)

| Элемент | Описание |
|---------|----------|
| **S**upplier | Кто поставляет входы |
| **I**nput | Что поступает на вход |
| **P**rocess | Основные шаги |
| **O**utput | Что выходит |
| **C**ustomer | Кто получает результат |

Обязательно добавляй Mermaid-диаграмму для визуализации (псевдографика запрещена).

## Шаблоны

Шаблоны в `templates/` (11 файлов):

### business-requirements

- `stakeholder.md.j2` — стейкхолдер
- `jtbd.md.j2` — Job To Be Done
- `goal.md.j2` — бизнес-цель
- `brq.md.j2` — бизнес-требование
- `process.md.j2` — процесс

### product-requirements

- `epic.md.j2` — эпик
- `feature.md.j2` — фича
- `user-story.md.j2` — User Story
- `entity.md.j2` — доменная сущность
- `business-rule.md.j2` — бизнес-правило

### Общее

- `term.md.j2` — термин глоссария

## Примеры

Смотри `examples/` для референсов (6 файлов):

- `stakeholder-example.md` — полный стейкхолдер с фреймворком
- `jtbd-example.md` — Main Job с Sub-jobs
- `process-example.md` — процесс с SIPOC и Mermaid
- `brq-example.md` — BRQ с обоснованием, критериями и трассировкой
- `epic-example.md` — эпик с фичами и view-блоками
- `feature-example.md` — фича с view-блоком User Stories

## Атрибуты (properties)

### Общие для обоих каталогов

| Property | Тип | Описание |
|----------|-----|----------|
| Тип сущности | Enum | Классификатор документа для view-фильтрации |
| Продукты | Enum | SIM, Project Ruler, ITAM, BPM, CSM, CRM, Платформа, Кросс-продукт |
| Sub домен | Enum | Service Desk, Service Manager, Knowledge Management, Portfolio Management, Resource Planning, Product Discovery, Product Delivery, HAM, SAM, CMDB |
| Домен | Enum | Core домен, Support домен, Generic домен |

### business-requirements

| Сущность | Обязательные | Опциональные |
|----------|-------------|-------------|
| Стейкхолдер | Тип сущности, Категория стейкхолдера, Продукты, Домен, Sub домен, Уровень влияния | RACI |
| JTBD | Тип сущности, Продукты, Sub домен, Стейкхолдер, Приоритет, Тип работы, Статус | — |
| Цель | Тип сущности, ID, Продукты, Домен, Sub домен, Приоритет, Статус | — |
| BRQ | Тип сущности, ID, Продукты, Sub домен, Приоритет, Статус, Источник JTBD, Связанная цель | Домен, Стейкхолдер, Процесс, Зависит от |
| Процесс | Тип сущности, Продукты, Домен, Sub домен, Владелец | Триггер |

### product-requirements

| Сущность | Обязательные | Опциональные |
|----------|-------------|-------------|
| Эпик | Тип сущности, ID, Продукты, Домен, Sub домен, Родительская цель, Приоритет, Статус, Размер | Источник BRQ |
| Фича | Тип сущности, ID, Продукты, Sub домен, Эпик | — |
| User Story | Тип сущности, Тип требования, ID, Стейкхолдер, Продукты, Домен, Sub домен, Эпик, Приоритет, Статус | Фича |
| Сущность | Тип сущности, Тип объекта, Продукты, Домен, Sub домен | — |
| Бизнес-правило | Тип сущности, Тип правила, Продукты, Домен, Sub домен | — |

## Конвенция именования ID

| Уровень | Формат | Пример |
|---------|--------|--------|
| Цель | `G-{PRODUCT}-{NNN}` | G-SIM-001 |
| BRQ | `BRQ-{SUBDOMAIN}-{NNN}` | BRQ-SD-001 |
| JTBD | `JTBD-{SUBDOMAIN}-{SS}-{NNN}` | JTBD-SD-01-001 |
| Эпик | `E-{SUBDOMAIN}-{NNN}` | E-SD-001 |
| Фича | `F-{SUBDOMAIN}-{EEE}-{FF}` | F-SD-001-01 |
| Story | `US-{SUBDOMAIN}-{NNN}` | US-SD-001 |

## Команды

### /extract [file] [options]

Извлечь сущности из файла.

```bash
# Из PDF в product-requirements
/extract product-requirements/sources/requirements.pdf

# С указанием Sub-домена
/extract product-requirements/sources/file.pdf --sub-domain "Service Desk"

# В бизнес-каталог
/extract business-requirements/sources/interviews.md --catalog business

# В режиме JTBD (трансформация US → JTBD)
/extract business-requirements/jtbd/service-desk/ --mode jtbd

# Только верификация
/extract product-requirements/sources/file.pdf --verify
```

### /board [type] [name]

Создать сущность интерактивно.

```bash
# business-requirements
/board stakeholder "Специалист поддержки"
/board jtbd "Получить помощь при проблеме"
/board goal "Единая точка обслуживания"
/board brq "Автоматическая классификация заявок"
/board process "Обработка заявки"

# product-requirements
/board epic "Регистрация заявок"
/board feature "Создание через портал"
/board story "Управление ролями"
/board entity "Заявка"
/board rule "Валидация SLA"
```

## View-блоки (связи)

View-блоки создают динамические связи через properties в Gramax.

**Синтаксис:** `<view defs="фильтры" groupby="свойство" display="List"/>`

**Принцип исключающего фильтра:** чтобы показать только один тип — перечисли все остальные типы через `&` с `&none` в конце:

```markdown
<!-- Показать только BRQ (исключить все остальные типы в business-requirements) -->
<view defs="Тип сущности=Стейкхолдер&JTBD&Цель&Процесс&none,Продукты=SIM" display="List"/>

<!-- Показать только Фичи эпика (исключить всё кроме Фича в product-requirements) -->
<view defs="Тип сущности=Стейкхолдер&JTBD&Цель&Эпик&User Story&Процесс&Сущность&Бизнес-правило&Релиз&none,Эпик=E-SD-001" display="List"/>

<!-- User Stories эпика, сгруппированные по фичам -->
<view defs="Тип сущности=Стейкхолдер&JTBD&Цель&Эпик&Фича&Процесс&Сущность&Бизнес-правило&Релиз&none,Эпик=E-SD-001" groupby="Фича" display="List"/>
```

## Модель трассируемости

```
БИЗНЕС (business-requirements/)           DEV (product-requirements/)
Стейкхолдер → JTBD → Цель → BRQ    →    Эпик → Фича → User Story
                                          ↕            ↕
                                      Сущность    Бизнес-правило
```

Связи через properties:
- `Стейкхолдер` — связь с ролью (JTBD, User Story)
- `Источник JTBD` — от BRQ к JTBD
- `Связанная цель` — от BRQ к Цели
- `Источник BRQ` — от Эпика к BRQ (cross-catalog)
- `Родительская цель` — от Эпика к Цели
- `Эпик` — от Фичи/Story к Эпику
- `Фича` — от Story к Фиче
- `Sub домен` — группировка по областям

## Интеграция с pdf-extract

Навык использует `tools/pdf_extract.py` для извлечения из PDF:

```bash
# Базовое извлечение
uv run pdf-extract product-requirements/sources/*.pdf --output product-requirements/stories/

# С принудительным Sub-доменом
uv run pdf-extract product-requirements/sources/file.pdf --sub-domain "Service Desk" --flat
```

## Guardrails

**Обязательно:**
- Определять целевой каталог (business-requirements или product-requirements) до сохранения
- Запрашивать подтверждение перед сохранением
- Проверять `.doc-root.yaml` целевого каталога на наличие properties
- Использовать значения из enum-списков каталога
- Создавать диаграммы только в формате Mermaid (псевдографика запрещена)
- Исправлять опечатки, грамматические и стилистические ошибки при извлечении

**Запрещено:**
- Сохранять без ревью пользователем
- Угадывать атрибуты без контекста
- Создавать дубликаты существующих сущностей
- Смешивать сущности разных каталогов в одном файле
- Использовать свойства, не определённые в `.doc-root.yaml` целевого каталога
