---
name: gramax
description: Создание и редактирование документации в формате Gramax — markdown с XML-блоками. Используй когда пользователь работает с Gramax-репозиторием, создаёт документацию, редактирует статьи, добавляет .doc-root.yaml, использует блоки note/tabs/view/snippet/mermaid/openapi. Совместимость с визуальным редактором Gramax.
---

# Gramax

Работа с документацией Gramax — создание, редактирование, структурирование каталогов.

## Core Principles

### 1. Сохраняй существующий формат

Если в репозитории уже есть контент — сохраняй его структуру, нейминг и форматирование. Не переформатируй таблицы, не меняй синтаксис блоков.

### 2. Следуй syntax из .doc-root.yaml

Если указано `syntax: XML`, используй XML-теги: `<note>`, `<tabs>`, `<view/>`, `<snippet/>`. Проверяй `.doc-root.yaml` перед редактированием.

### 3. Храни вложения рядом со страницей

Изображения, PDF, YAML, Mermaid-файлы — в той же папке, что и страница, которая их использует.

### 4. Не ломай макросы форматированием

Автоформатирование может сломать блоки Gramax. Сохраняй пустые строки вокруг `<note>`, `<tabs>`, `<table>`. Не трогай самозакрывающиеся теги.

## Workflow

### При первой операции

1. Найди `.doc-root.yaml` в корне репозитория
2. Прочитай поле `syntax` (XML или Markdown)
3. Прочитай `language` для определения языка контента
4. Применяй соответствующее форматирование во всех операциях

### При создании/редактировании

1. Определи целевую папку
2. Сформируй имя файла по правилам нейминга
3. Создай frontmatter (order, title)
4. Добавь контент с блоками в правильном syntax

## Структура репозитория

### Каталог и .doc-root.yaml

`.doc-root.yaml` в корне каталога — конфигурация:

```yaml
code: DOCS
title: Documentation
description: Описание каталога.
style: black
language: ru
supportedLanguages:
  - ru
syntax: XML
```

Опциональные поля: `logo`, `relatedLinks`, `versions`, `properties`.

### Структура папок

- Папка = раздел документации
- `_index.md` = главная страница раздела
- `.md` файлы = дочерние страницы
- Подпапки = вложенные разделы
- `.gramax/` = служебная папка редактора (не трогать)

```
.
├── .doc-root.yaml
├── getting-started/
│   ├── _index.md
│   ├── quick-start.md
│   └── installation.md
└── features/
    ├── _index.md
    └── advanced/
        └── _index.md
```

### Превращение страницы в раздел

Когда к странице добавляется вложенная статья, страница становится разделом:

**До (простая страница):**
```
parent-folder/
├── _index.md
└── my-article.md              # простая страница
```

**После (раздел с вложенной статьёй):**
```
parent-folder/
├── _index.md
└── my-article/                # теперь папка
    ├── _index.md              # содержимое бывшей my-article.md
    ├── _index.comments.yaml   # комментарии (если были)
    └── nested-article.md      # вложенная статья
```

**Операции при трансформации:**

| Было | Стало |
|------|-------|
| `my-article.md` | `my-article/_index.md` |
| `my-article.comments.yaml` | `my-article/_index.comments.yaml` |
| Вложения рядом с `my-article.md` | Переместить в `my-article/` |

**Важно:** Обнови все ссылки на эту страницу — путь меняется с `./my-article` на `./my-article/_index`.

### Операции со структурой

#### Добавить статью в существующий раздел

Раздел — папка с `_index.md`. Просто создай новый `.md` файл:

```
existing-section/
├── _index.md
├── existing-article.md
└── new-article.md          # ← создать файл
```

#### Добавить вложенную статью в раздел

Если раздел уже существует, добавь файл внутрь:

```
existing-section/
├── _index.md
├── sub-section/
│   ├── _index.md
│   └── new-nested.md       # ← создать файл
```

#### Добавить новый раздел

Создай папку с `_index.md`:

```
parent/
├── _index.md
└── new-section/            # ← создать папку
    └── _index.md           # ← создать файл
```

#### Переместить статью

1. Перемести `.md` файл
2. Перемести `.comments.yaml` (если есть)
3. Перемести вложения, используемые статьёй
4. Обнови все ссылки на эту статью

#### Переместить раздел

1. Перемести всю папку целиком
2. Обнови ссылки на все страницы внутри раздела

#### Удалить статью

1. Удали `.md` файл
2. Удали `.comments.yaml` (если есть)
3. Удали неиспользуемые вложения
4. Убери ссылки на эту статью

#### Удалить раздел

1. Удали папку целиком (включая `_index.md`, все статьи, вложения)
2. Убери ссылки на страницы этого раздела

## Frontmatter страниц

В начале каждого `.md` файла:

```yaml
---
order: 1
title: Название страницы
---
```

- `order` — числовой порядок в навигации (целые или десятичные для вставки между)
- `title` — заголовок на языке страницы
- `properties` — опционально, если страница использует свойства статей

## Нейминг файлов и папок

### Правила

1. **Транслитерация** — кириллица → латиница (упрощённая)
2. **Разделитель** — пробелы и спецсимволы → дефис `-`
3. **Регистр** — только lowercase
4. **Удалить** — кавычки, скобки, точки (кроме расширения)
5. **Множественные дефисы** — схлопнуть в один

### Таблица транслитерации

| Буква | Транслит | Буква | Транслит |
|-------|----------|-------|----------|
| а | a | р | r |
| б | b | с | s |
| в | v | т | t |
| г | g | у | u |
| д | d | ф | f |
| е | e | х | kh |
| ё | yo | ц | ts |
| ж | zh | ч | ch |
| з | z | ш | sh |
| и | i | щ | shch |
| й | y | ъ | (пропуск) |
| к | k | ы | y |
| л | l | ь | (пропуск) |
| м | m | э | e |
| н | n | ю | yu |
| о | o | я | ya |
| п | p | | |

### Примеры

| Заголовок | Имя файла |
|-----------|-----------|
| Быстрый старт | `bystryy-start.md` |
| Установка и настройка | `ustanovka-i-nastroyka.md` |
| API-интеграция | `api-integratsiya.md` |
| Раздел «Документы» | `razdel-dokumenty/` |
| Что нового? | `chto-novogo.md` |

## Ссылки

- Относительные пути без расширения `.md`: `./../app/_index`
- На разделы через `_index`: `./features/_index`
- На вложения с расширением: `./diagram.png`, `./file.pdf`

## Медиа

### Изображения

Markdown-синтаксис с размерами:

```markdown
![](./screenshot.png){width=800 height=450}
```

Для кропов/аннотаций используется XML-синтаксис — редактируй только если необходимо.

### Диаграммы

```markdown
<mermaid path="./architecture.mermaid" width="800px" height="450px"/>
```

Содержимое `.mermaid` файла — стандартный Mermaid-синтаксис.

## Блоки Gramax

Краткая справка. Детали: `references/blocks.md`

| Блок | Синтаксис | Назначение |
|------|-----------|------------|
| Заметка | `<note type="tip">...</note>` | Callout с типом |
| Табы | `<tabs><tab name="A">...</tab></tabs>` | Переключаемые вкладки |
| Вью | `<view defs="hierarchy=none" display="List"/>` | Список дочерних страниц |
| Сниппет | `<snippet id="name"/>` | Вставка из `.gramax/snippets/` |
| OpenAPI | `<openapi src="./api.yaml"/>` | Спецификация API |
| Видео | `<video path="URL"/>` | Встроенное видео |
| HTML | `<html>...</html>` | Сырой HTML |
| Иконка | `<icon code="lucide-name"/>` | Lucide-иконка |

**UI-токены:** `[cmd:Label]`, `[kbd:Ctrl+S]`, `[alfa]`, `[beta]`

## Bootstrap нового репозитория

Минимальная структура:

```
.
├── .doc-root.yaml
└── getting-started/
    ├── _index.md
    └── quick-start.md
```

**getting-started/_index.md:**

```markdown
---
order: 1
title: Начало работы
---

Краткое введение в раздел.

<view defs="hierarchy=none" display="List"/>
```

**getting-started/quick-start.md:**

```markdown
---
order: 1
title: Быстрый старт
---

Содержимое страницы.
```

## Комментарии

Комментарии хранятся в двух местах:

1. **В .md файле** — инлайн-разметка с ID
2. **В .comments.yaml** — данные комментариев (автор, дата, текст, ответы)

### Инлайн-комментарий

```markdown
Текст с <comment id="abc12">выделенным фрагментом</comment>.
```

### Файл комментариев

Для `page.md` создаётся `page.comments.yaml`:

```yaml
abc12:
  comment:
    dateTime: '2026-01-30T14:22:47.567Z'
    user:
      mail: user@example.com
      name: Имя Фамилия
    content: Текст комментария
  answers:
    - user:
        mail: reviewer@example.com
        name: Имя Рецензента
      dateTime: '2026-01-30T14:30:00.000Z'
      content: Ответ на комментарий
```

### Операции

| Операция | Действия |
|----------|----------|
| Добавить | Вставь `<comment id="XXX">` в .md + создай запись в .comments.yaml |
| Ответить | Добавь элемент в `answers` в .comments.yaml |
| Удалить | Убери тег из .md + удали ключ из .comments.yaml |
| Переместить страницу | Перемести .comments.yaml вместе со страницей |

**ID комментария:** 5 символов, alphanumeric (a-z, A-Z, 0-9).

### Данные автора

При добавлении первого комментария в сессии:
1. Спроси у пользователя email и имя
2. Используй эти данные для всех последующих комментариев в сессии

**Пример запроса:**
> Для комментария нужны данные автора. Укажи email и имя (например: `ivan@company.ru Иван Петров`)

**Время:** текущее UTC в формате ISO 8601.

Детали: `references/blocks.md` → раздел «Комментарии»

## Guardrails

- Не удаляй/переименовывай `.gramax/`
- При переименовании страниц — обнови все ссылки
- Валидируй парные теги: `</note>`, `</tabs>`, `</tab>`, `</html>`
- Сохраняй пустые строки внутри `<table>`, `<note>`, `<tabs>`

## Ресурсы

- `references/blocks.md` — детальная документация всех блоков
